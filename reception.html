<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Status Board - Public View</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="dcfire.js"></script>
    <style>
        :root {
            --primary-blue: #1a56db;
            --primary-blue-dark: #1e429f;
            --primary-blue-light: #3f83f8;
            --primary-blue-bg: #eff6ff;
            
            --secondary-gray: #6b7280;
            --secondary-gray-dark: #374151;
            --secondary-gray-light: #9ca3af;
            --secondary-gray-bg: #f9fafb;
            
            --success-green: #059669;
            --success-green-light: #10b981;
            --success-green-bg: #d1fae5;
            
            --warning-orange: #f59e0b;
            --warning-orange-light: #fbbf24;
            --warning-orange-bg: #fef3c7;
            
            --danger-red: #dc2626;
            --danger-red-light: #ef4444;
            --danger-red-bg: #fee2e2;
            
            --sick-yellow: #d97706;
            --sick-yellow-bg: #fef3c7;
            
            --frl-teal: #0d9488;
            --frl-teal-bg: #ccfbf1;
            
            --surface-white: #ffffff;
            --surface-light: #f8fafc;
            --surface-dark: #1f2937;
            
            --border-light: #e5e7eb;
            --border-dark: #d1d5db;
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--secondary-gray-dark);
            min-height: 100vh;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--surface-white) 0%, var(--primary-blue-bg) 100%);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--primary-blue-light) 0%, transparent 70%);
            opacity: 0.1;
        }

        .header h1 {
            color: var(--primary-blue-dark);
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header .subtitle {
            color: var(--secondary-gray);
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        .current-date {
            color: var(--secondary-gray);
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .current-date::before {
            content: 'üïí';
        }

        .refresh-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .refresh-btn:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--surface-white);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card.full-width {
            grid-column: 1 / -1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-blue-bg);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--secondary-gray-dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title .icon {
            color: var(--primary-blue);
            font-size: 1.5rem;
        }

        /* Stats Overview */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface-white);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue-dark);
            line-height: 1;
            margin: 0.5rem 0;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--secondary-gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .stat-trend {
            font-size: 0.75rem;
            color: var(--success-green);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .stat-card.sick {
            border-top: 4px solid var(--sick-yellow);
        }

        .stat-card.frl {
            border-top: 4px solid var(--frl-teal);
        }

        .stat-card.duty-change {
            border-top: 4px solid var(--primary-blue);
        }

        .stat-card.on-duty {
            border-top: 4px solid var(--success-green);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            margin-top: 1rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--surface-white);
            font-size: 0.875rem;
        }

        .data-table thead {
            background: var(--secondary-gray-bg);
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--secondary-gray-dark);
            border-bottom: 1px solid var(--border-light);
            white-space: nowrap;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
            color: var(--secondary-gray);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background: var(--primary-blue-bg);
        }

        /* Status Badges */
        .status-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }

        .status-badge::before {
            content: '‚óè';
            font-size: 0.5rem;
        }

        .status-sick {
            background: var(--sick-yellow-bg);
            color: var(--sick-yellow);
        }

        .status-frl {
            background: var(--frl-teal-bg);
            color: var(--frl-teal);
        }

        .status-pending {
            background: var(--warning-orange-bg);
            color: var(--warning-orange);
        }

        .status-approved {
            background: var(--success-green-bg);
            color: var(--success-green);
        }

        .status-rejected {
            background: var(--danger-red-bg);
            color: var(--danger-red);
        }

        /* Staff Status Board */
        .status-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .staff-card {
            background: var(--surface-white);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .staff-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .staff-card.sick {
            border-left: 4px solid var(--sick-yellow);
        }

        .staff-card.frl {
            border-left: 4px solid var(--frl-teal);
        }

        .staff-card.on-duty {
            border-left: 4px solid var(--success-green);
        }

        .staff-card.off-duty {
            border-left: 4px solid var(--secondary-gray-light);
        }

        .staff-name {
            font-weight: 600;
            color: var(--secondary-gray-dark);
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .staff-rc {
            font-size: 0.75rem;
            color: var(--secondary-gray);
            margin-bottom: 0.75rem;
        }

        .staff-status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .staff-duty-time {
            font-size: 0.875rem;
            color: var(--secondary-gray-dark);
            font-weight: 500;
            margin-top: 0.5rem;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--surface-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--secondary-gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background: var(--secondary-gray-bg);
            border-color: var(--border-dark);
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        /* Forms */
        .form-section {
            background: linear-gradient(135deg, var(--surface-white) 0%, var(--secondary-gray-bg) 100%);
            border-radius: var(--radius-lg);
            padding: 2rem;
            border: 1px solid var(--border-light);
            margin-top: 2rem;
        }

        .form-section h3 {
            color: var(--primary-blue-dark);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--secondary-gray-dark);
            margin-bottom: 0.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: var(--transition);
            background: var(--surface-white);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-success:hover {
            background: var(--success-green-light);
        }

        .btn-secondary {
            background: var(--secondary-gray);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--secondary-gray-dark);
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            border-left: 4px solid;
            font-size: 0.875rem;
        }

        .alert-info {
            background: var(--primary-blue-bg);
            border-color: var(--primary-blue);
            color: var(--primary-blue-dark);
        }

        .alert-success {
            background: var(--success-green-bg);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .alert-warning {
            background: var(--warning-orange-bg);
            border-color: var(--warning-orange);
            color: var(--warning-orange);
        }

        .alert-danger {
            background: var(--danger-red-bg);
            border-color: var(--danger-red);
            color: var(--danger-red);
        }

        /* Loading States */
        .loading-state {
            padding: 3rem;
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--secondary-gray);
        }

        .empty-state .icon {
            font-size: 3rem;
            opacity: 0.5;
            margin-bottom: 1rem;
        }

        /* Color Legend */
        .color-legend {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--secondary-gray-bg);
            border-radius: var(--radius-md);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--secondary-gray);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.sick { background: var(--sick-yellow-bg); border: 2px solid var(--sick-yellow); }
        .legend-color.frl { background: var(--frl-teal-bg); border: 2px solid var(--frl-teal); }
        .legend-color.on-duty { background: var(--success-green-bg); border: 2px solid var(--success-green); }
        .legend-color.off-duty { background: var(--secondary-gray-bg); border: 2px solid var(--secondary-gray-light); }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--surface-white);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .activity-item:hover {
            background: var(--primary-blue-bg);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-icon.sick { background: var(--sick-yellow-bg); color: var(--sick-yellow); }
        .activity-icon.frl { background: var(--frl-teal-bg); color: var(--frl-teal); }
        .activity-icon.duty-change { background: var(--primary-blue-bg); color: var(--primary-blue); }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 500;
            color: var(--secondary-gray-dark);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--secondary-gray);
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-light);
            color: var(--secondary-gray);
            font-size: 0.875rem;
        }

        .last-updated {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.75rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.75rem;
            }
            
            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-board {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }

        /* Utility Classes */
        .text-success { color: var(--success-green); }
        .text-warning { color: var(--warning-orange); }
        .text-danger { color: var(--danger-red); }
        .text-info { color: var(--primary-blue); }
        .text-muted { color: var(--secondary-gray); }

        .bg-success { background: var(--success-green-bg); }
        .bg-warning { background: var(--warning-orange-bg); }
        .bg-danger { background: var(--danger-red-bg); }
        .bg-info { background: var(--primary-blue-bg); }

        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-5 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mb-5 { margin-bottom: 2rem; }
    </style>
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>
                <span>üìã</span>
                Duty Status Dashboard
            </h1>
            <p class="subtitle">Real-time staff attendance and duty management overview</p>
            
            <div class="header-info">
                <div class="current-date" id="currentDateTime">Loading...</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span class="text-muted">Public View ‚Ä¢ No Login Required</span>
                    <button class="refresh-btn" onclick="loadAllData()">
                        <span>‚Üª</span>
                        Refresh Data
                    </button>
                </div>
            </div>
        </header>

        <!-- Overview Statistics -->
        <div class="stats-overview" id="overviewStats">
            <!-- Stats will be populated here -->
            <div class="loading-state">
                <div class="spinner"></div>
                <p class="text-muted">Loading statistics...</p>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Today's Sick Leave -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ü§í</span>
                        Today's Sick Leave
                    </h2>
                    <span class="status-badge status-sick" id="sickCount">0</span>
                </div>
                <div id="todaySickLeave">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p class="text-muted">Loading sick leave data...</p>
                    </div>
                </div>
            </div>

            <!-- Today's FRL -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">üèùÔ∏è</span>
                        Today's FRL
                    </h2>
                    <span class="status-badge status-frl" id="frlCount">0</span>
                </div>
                <div id="todayFRL">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p class="text-muted">Loading FRL data...</p>
                    </div>
                </div>
            </div>

            <!-- Approved Duty Changes -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">üîÑ</span>
                        Approved Duty Changes
                    </h2>
                    <span class="text-muted">Today & Tomorrow</span>
                </div>
                
                <div class="filters" id="dutyChangeFilters">
                    <button class="filter-btn active" onclick="filterDutyChanges('all')">All Changes</button>
                    <button class="filter-btn" onclick="filterDutyChanges('today')">Today Only</button>
                    <button class="filter-btn" onclick="filterDutyChanges('tomorrow')">Tomorrow</button>
                </div>
                
                <div id="approvedDutyChanges">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p class="text-muted">Loading duty changes...</p>
                    </div>
                </div>
            </div>

            <!-- Staff Status Board -->
            <div class="card full-width">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">üë•</span>
                        Staff Status Board
                    </h2>
                    <span class="text-muted" id="staffCount">0 staff</span>
                </div>
                
                <div class="color-legend">
                    <div class="legend-item">
                        <div class="legend-color sick"></div>
                        <span>Sick Leave</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color frl"></div>
                        <span>FRL</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color on-duty"></div>
                        <span>On Duty</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color off-duty"></div>
                        <span>Off Duty</span>
                    </div>
                </div>
                
                <div class="status-board" id="staffStatusBoard">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p class="text-muted">Loading staff status...</p>
                    </div>
                </div>
            </div>

            <!-- Phone-Reported Leave Form -->
            <div class="form-section">
                <h3>
                    <span>üìû</span>
                    Phone-Reported Leave Entry
                </h3>
                
                <div class="alert alert-info">
                    Use this form to record leaves reported by phone. A pending leave request will be created for supervisor approval.
                </div>
                
                <form id="phoneLeaveForm" onsubmit="submitPhoneLeave(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="phoneStaffName">Staff Name *</label>
                            <input type="text" id="phoneStaffName" class="form-control" 
                                   placeholder="Enter staff name" required>
                            <small class="text-muted">Start typing to see suggestions</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneStaffRC">RC Number *</label>
                            <input type="text" id="phoneStaffRC" class="form-control" 
                                   placeholder="Enter RC number" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneLeaveType">Leave Type *</label>
                            <select id="phoneLeaveType" class="form-control" required>
                                <option value="">Select leave type</option>
                                <option value="Sick Leave">Sick Leave</option>
                                <option value="FRL">FRL</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneLeaveDate">Leave Date *</label>
                            <input type="date" id="phoneLeaveDate" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneDutyTime">Duty Time *</label>
                            <input type="text" id="phoneDutyTime" class="form-control" 
                                   placeholder="e.g., 08:00-16:00" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneDuration">Duration *</label>
                            <select id="phoneDuration" class="form-control" required>
                                <option value="1">1 Day</option>
                                <option value="0.5">Half Day</option>
                                <option value="2">2 Days</option>
                                <option value="3">3 Days</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneReason">Reason for Leave *</label>
                        <textarea id="phoneReason" class="form-control" rows="3" 
                                  placeholder="Enter reason for leave (e.g., fever, personal work, etc.)" 
                                  required></textarea>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="phoneReportedBy">Reported By *</label>
                            <input type="text" id="phoneReportedBy" class="form-control" 
                                   placeholder="Your name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="phoneContact">Contact Number</label>
                            <input type="text" id="phoneContact" class="form-control" 
                                   placeholder="Contact number (optional)">
                        </div>
                    </div>
                    
                    <div class="alert alert-warning" id="phoneFormAlert" style="display: none;">
                        Please fill all required fields marked with *
                    </div>
                    
                    <div class="alert alert-success" id="phoneFormSuccess" style="display: none;">
                        ‚úì Leave successfully recorded! A pending request has been created for supervisor approval.
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <span>üìû</span>
                            Submit Phone-Reported Leave
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearPhoneForm()">
                            Clear Form
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">üïí</span>
                        Recent Activity
                    </h2>
                </div>
                
                <div class="activity-feed" id="recentActivity">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <p class="text-muted">Loading recent activity...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Duty Status Dashboard ‚Ä¢ Version 1.0 ‚Ä¢ Public View</p>
            <div class="last-updated">
                <span>üîÑ Auto-refreshes every 60 seconds</span>
                <span>‚Ä¢</span>
                <span>Last updated: <strong id="lastUpdatedTime">--:--:--</strong></span>
            </div>
        </footer>
    </div>

    <script>
         // Global variables
        let allStaff = [];
        let dutyRoster = {};
        let leaveRequests = [];
        let allRequests = [];
        let refreshInterval;
        let currentDate = new Date().toISOString().split('T')[0];

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Duty Status Board loading...');
            
            // Set default date for forms
            document.getElementById('phoneLeaveDate').value = currentDate;
            
            // Load all data
            loadAllData();
            
            // Start auto-refresh
            startAutoRefresh();
            
            // Update current date/time display
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Setup staff name suggestions
            setupStaffSuggestions();
        });

        // Load all data from Firebase
        async function loadAllData() {
            try {
                console.log('Loading data from Firebase...');
                
                // Update last updated time
                updateLastUpdatedTime();
                
                // Load staff data (you may need to store staff list in Firebase)
                await loadStaffData();
                
                // Load duty roster
                await loadDutyRoster();
                
                // Load leave requests
                await loadLeaveRequests();
                
                // Load all requests
                await loadAllRequests();
                
                // Update all displays
                updateAllDisplays();
                
                console.log('Data loaded successfully');
            } catch (error) {
                console.error('Error loading data:', error);
                showErrorMessage('Failed to load data. Please refresh the page.');
            }
        }

        // Load staff data
        async function loadStaffData() {
            try {
                // Try to load from Firebase or use default data
                // You may want to create a 'staff' collection in Firebase
                const staffDoc = await db.collection('staff').doc('all').get();
                if (staffDoc.exists) {
                    allStaff = staffDoc.data().staff || [];
                } else {
                    // Default staff list (you should populate this from your main app)
                    allStaff = [
                        { name: "Irufan1", rcNo: "001", username: "irufan1" },
                        { name: "Irufan2", rcNo: "002", username: "irufan2" },
                        { name: "Hussain", rcNo: "003", username: "hussain" },
                        { name: "Mohamed", rcNo: "004", username: "mohamed" }
                        // Add more staff as needed
                    ];
                }
                
                console.log('Staff data loaded:', allStaff.length, 'staff members');
            } catch (error) {
                console.error('Error loading staff data:', error);
                allStaff = [];
            }
        }

        // Load duty roster
        async function loadDutyRoster() {
            try {
                const rosterDoc = await db.collection('dutyRoster').doc('current').get();
                if (rosterDoc.exists) {
                    dutyRoster = rosterDoc.data() || {};
                    console.log('Duty roster loaded:', Object.keys(dutyRoster).length, 'dates');
                } else {
                    dutyRoster = {};
                    console.log('No duty roster found');
                }
            } catch (error) {
                console.error('Error loading duty roster:', error);
                dutyRoster = {};
            }
        }

        // Load leave requests
        async function loadLeaveRequests() {
            try {
                // This would be from your main app's requests collection
                const requestsDoc = await db.collection('requests').doc('all').get();
                if (requestsDoc.exists && requestsDoc.data().requests) {
                    allRequests = requestsDoc.data().requests;
                    console.log('Requests loaded:', allRequests.length, 'requests');
                    
                    // Filter for leave requests
                    leaveRequests = allRequests.filter(req => req.type === 'leave');
                } else {
                    allRequests = [];
                    leaveRequests = [];
                    console.log('No requests found');
                }
            } catch (error) {
                console.error('Error loading requests:', error);
                allRequests = [];
                leaveRequests = [];
            }
        }

        // Load all requests (for activity feed)
        async function loadAllRequests() {
            try {
                // Already loaded in loadLeaveRequests()
                // Filter for recent activity
                const today = new Date();
                const sevenDaysAgo = new Date(today);
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                
                // Get recent requests for activity feed
                recentRequests = allRequests.filter(req => {
                    const reqDate = new Date(req.timestamp || req.approvedAt || req.createdAt);
                    return reqDate >= sevenDaysAgo;
                });
                
                // Sort by date (newest first)
                recentRequests.sort((a, b) => {
                    const dateA = new Date(a.timestamp || a.approvedAt || a.createdAt);
                    const dateB = new Date(b.timestamp || b.approvedAt || b.createdAt);
                    return dateB - dateA;
                });
            } catch (error) {
                console.error('Error loading all requests:', error);
            }
        }

        // Update all displays
        function updateAllDisplays() {
            updateOverviewStats();
            updateTodaySickLeave();
            updateTodayFRL();
            updateApprovedDutyChanges();
            updateStaffStatusBoard();
            updateRecentActivity();
        }

        // Update overview statistics
        function updateOverviewStats() {
            const container = document.getElementById('overviewStats');
            const today = currentDate;
            
            // Get today's leave requests
            const todaySickLeave = leaveRequests.filter(req => 
                req.status === 'approved' && 
                req.date === today && 
                req.leaveType === 'Sick Leave'
            ).length;
            
            const todayFRL = leaveRequests.filter(req => 
                req.status === 'approved' && 
                req.date === today && 
                req.leaveType === 'FRL'
            ).length;
            
            // Get duty changes for today
            const todayDutyChanges = allRequests.filter(req => 
                req.type === 'dutyChange' && 
                req.status === 'approved' && 
                req.date === today
            ).length;
            
            // Count staff on duty today
            let onDutyCount = 0;
            if (dutyRoster[today]) {
                Object.values(dutyRoster[today]).forEach(duty => {
                    if (duty && duty !== 'Off' && duty !== 'Not Scheduled') {
                        onDutyCount++;
                    }
                });
            }
            
            container.innerHTML = `
                <div class="stat-box sick">
                    <div class="stat-label">Sick Leave</div>
                    <div class="stat-value">${todaySickLeave}</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-box frl">
                    <div class="stat-label">FRL</div>
                    <div class="stat-value">${todayFRL}</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-box duty-change">
                    <div class="stat-label">Duty Changes</div>
                    <div class="stat-value">${todayDutyChanges}</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-box on-duty">
                    <div class="stat-label">On Duty</div>
                    <div class="stat-value">${onDutyCount}</div>
                    <div class="stat-label">Today</div>
                </div>
            `;
        }

        // Update today's sick leave display
        function updateTodaySickLeave() {
            const container = document.getElementById('todaySickLeave');
            const today = currentDate;
            
            const todaySickRequests = leaveRequests.filter(req => 
                req.status === 'approved' && 
                req.date === today && 
                req.leaveType === 'Sick Leave'
            );
            
            if (todaySickRequests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üòä</div>
                        <p>No sick leave today</p>
                        <p style="font-size: 12px;">All staff are healthy!</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="table-container"><table><thead><tr><th>Staff</th><th>RC</th><th>Duration</th><th>Reason</th><th>Reported</th></tr></thead><tbody>';
            
            todaySickRequests.forEach(req => {
                const staff = allStaff.find(s => s.username === req.fromUsername) || { name: req.fromName, rcNo: req.fromRcNo };
                const reportedTime = req.timestamp ? formatTime(new Date(req.timestamp)) : 'Unknown';
                
                html += `
                    <tr>
                        <td><strong>${staff.name}</strong></td>
                        <td>${staff.rcNo}</td>
                        <td><span class="status-badge status-sick">${req.duration} day(s)</span></td>
                        <td>${req.reason || 'Not specified'}</td>
                        <td class="timestamp">${reportedTime}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Update today's FRL display
        function updateTodayFRL() {
            const container = document.getElementById('todayFRL');
            const today = currentDate;
            
            const todayFRLRequests = leaveRequests.filter(req => 
                req.status === 'approved' && 
                req.date === today && 
                req.leaveType === 'FRL'
            );
            
            if (todayFRLRequests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üòä</div>
                        <p>No FRL today</p>
                        <p style="font-size: 12px;">All staff are available!</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="table-container"><table><thead><tr><th>Staff</th><th>RC</th><th>Duration</th><th>Reason</th><th>Reported</th></tr></thead><tbody>';
            
            todayFRLRequests.forEach(req => {
                const staff = allStaff.find(s => s.username === req.fromUsername) || { name: req.fromName, rcNo: req.fromRcNo };
                const reportedTime = req.timestamp ? formatTime(new Date(req.timestamp)) : 'Unknown';
                
                html += `
                    <tr>
                        <td><strong>${staff.name}</strong></td>
                        <td>${staff.rcNo}</td>
                        <td><span class="status-badge status-frl">${req.duration} day(s)</span></td>
                        <td>${req.reason || 'Not specified'}</td>
                        <td class="timestamp">${reportedTime}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Update approved duty changes
        function updateApprovedDutyChanges() {
            const container = document.getElementById('approvedDutyChanges');
            
            // Get approved duty changes for today and tomorrow
            const today = currentDate;
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const approvedChanges = allRequests.filter(req => 
                req.type === 'dutyChange' && 
                req.status === 'approved' && 
                (req.date === today || req.date === tomorrowStr)
            );
            
            if (approvedChanges.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üîÑ</div>
                        <p>No approved duty changes</p>
                        <p style="font-size: 12px;">All duties are as scheduled</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date then time
            approvedChanges.sort((a, b) => {
                if (a.date === b.date) {
                    return (a.timestamp || '').localeCompare(b.timestamp || '');
                }
                return a.date.localeCompare(b.date);
            });
            
            let html = '';
            
            approvedChanges.forEach(req => {
                const isToday = req.date === today;
                const dateLabel = isToday ? 'Today' : 'Tomorrow';
                
                html += `
                    <div class="duty-change-item duty-change-approved">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>${dateLabel} (${req.date})</strong><br>
                                <span style="font-size: 14px;">
                                    ${req.fromName} (${req.dutyTime}) ‚Üî ${req.toName} (${req.toDutyTime})
                                </span>
                                ${req.reason ? `<div style="margin-top: 5px; font-size: 13px; color: #666;">Reason: ${req.reason}</div>` : ''}
                            </div>
                            <div style="text-align: right;">
                                <span class="status-badge status-approved">Approved</span><br>
                                <span style="font-size: 11px; color: #7f8c8d;">${formatTimeAgo(req.approvedAt || req.timestamp)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Filter duty changes
        function filterDutyChanges(filter) {
            // Update filter buttons
            document.querySelectorAll('#dutyChangeFilters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // For now, just reload the data
            updateApprovedDutyChanges();
        }

        // Update staff status board
        function updateStaffStatusBoard() {
            const container = document.getElementById('staffStatusBoard');
            const today = currentDate;
            
            if (allStaff.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="icon">üë•</div>
                        <p>No staff data available</p>
                        <p style="font-size: 12px;">Please check Firebase connection</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            allStaff.forEach(staff => {
                // Check if staff is on leave today
                const todayLeave = leaveRequests.find(req => 
                    req.status === 'approved' && 
                    req.date === today && 
                    req.fromUsername === staff.username
                );
                
                // Get today's duty
                let dutyTime = 'Not Scheduled';
                let dutyStatus = 'Not Scheduled';
                if (dutyRoster[today] && dutyRoster[today][staff.username]) {
                    dutyTime = dutyRoster[today][staff.username];
                    dutyStatus = dutyTime === 'Off' ? 'Off Duty' : 'On Duty';
                }
                
                // Determine card class based on status
                let cardClass = 'staff-card';
                let statusBadge = '';
                let statusDetails = '';
                
                if (todayLeave) {
                    cardClass += todayLeave.leaveType === 'Sick Leave' ? ' sick' : ' frl';
                    statusBadge = `<span class="status-badge ${todayLeave.leaveType === 'Sick Leave' ? 'status-sick' : 'status-frl'}">${todayLeave.leaveType}</span>`;
                    statusDetails = `<div class="staff-details">${todayLeave.reason || 'Not specified'}</div>`;
                    dutyStatus = `On ${todayLeave.leaveType}`;
                } else if (dutyTime === 'Off') {
                    cardClass += ' off-duty';
                    dutyStatus = 'Off Duty';
                } else if (dutyTime && dutyTime !== 'Not Scheduled') {
                    cardClass += ' on-duty';
                }
                
                html += `
                    <div class="${cardClass}">
                        <div class="staff-name">${staff.name}</div>
                        <div class="staff-rc">RC: ${staff.rcNo}</div>
                        <div class="staff-status">${statusBadge} ${dutyStatus}</div>
                        <div class="staff-duty-time">${dutyTime}</div>
                        ${statusDetails}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update recent activity
        function updateRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            // Get recent activity (last 10 items)
            const recentActivity = allRequests.slice(0, 10);
            
            if (recentActivity.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üïí</div>
                        <p>No recent activity</p>
                        <p style="font-size: 12px;">Activity will appear here</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            recentActivity.forEach(req => {
                let activityClass = 'activity-item';
                let icon = 'üìù';
                let description = '';
                let time = req.timestamp || req.approvedAt || req.createdAt;
                
                if (req.type === 'leave') {
                    activityClass += req.leaveType === 'Sick Leave' ? ' activity-sick' : ' activity-frl';
                    icon = req.leaveType === 'Sick Leave' ? 'ü§í' : 'üèùÔ∏è';
                    description = `${req.fromName} - ${req.leaveType} (${req.duration} day)`;
                } else if (req.type === 'dutyChange') {
                    activityClass += ' activity-duty-change';
                    icon = 'üîÑ';
                    description = `${req.fromName} ‚Üî ${req.toName}`;
                }
                
                html += `
                    <div class="${activityClass}">
                        <div style="display: flex; align-items: start; gap: 10px;">
                            <div style="font-size: 18px;">${icon}</div>
                            <div>
                                <div>${description}</div>
                                <div class="activity-time">${formatTimeAgo(time)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Setup staff name suggestions
        function setupStaffSuggestions() {
            const nameInput = document.getElementById('phoneStaffName');
            const rcInput = document.getElementById('phoneStaffRC');
            const suggestionsDiv = document.getElementById('staffSuggestions');
            
            nameInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                if (query.length < 2) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }
                
                const matches = allStaff.filter(staff => 
                    staff.name.toLowerCase().includes(query) || 
                    staff.rcNo.includes(query)
                ).slice(0, 5);
                
                if (matches.length === 0) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }
                
                suggestionsDiv.innerHTML = '';
                matches.forEach(staff => {
                    const div = document.createElement('div');
                    div.style.padding = '8px';
                    div.style.cursor = 'pointer';
                    div.style.borderBottom = '1px solid #eee';
                    div.innerHTML = `${staff.name} (RC: ${staff.rcNo})`;
                    div.onclick = function() {
                        nameInput.value = staff.name;
                        rcInput.value = staff.rcNo;
                        suggestionsDiv.style.display = 'none';
                    };
                    suggestionsDiv.appendChild(div);
                });
                
                suggestionsDiv.style.display = 'block';
                suggestionsDiv.style.width = nameInput.offsetWidth + 'px';
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!nameInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
        }

        // Submit phone-reported leave
        async function submitPhoneLeave(event) {
            event.preventDefault();
            
            const staffName = document.getElementById('phoneStaffName').value.trim();
            const rcNo = document.getElementById('phoneStaffRC').value.trim();
            const leaveType = document.getElementById('phoneLeaveType').value;
            const leaveDate = document.getElementById('phoneLeaveDate').value;
            const dutyTime = document.getElementById('phoneDutyTime').value.trim();
            const duration = document.getElementById('phoneDuration').value;
            const reason = document.getElementById('phoneReason').value.trim();
            const reportedBy = document.getElementById('phoneReportedBy').value.trim();
            const contact = document.getElementById('phoneContact').value.trim();
            
            // Validation
            if (!staffName || !rcNo || !leaveType || !leaveDate || !dutyTime || !reason || !reportedBy) {
                document.getElementById('phoneFormAlert').style.display = 'block';
                document.getElementById('phoneFormAlert').textContent = 'Please fill all required fields marked with *';
                document.getElementById('phoneFormAlert').className = 'alert alert-danger';
                return;
            }
            
            // Find or create staff
            let staff = allStaff.find(s => s.rcNo === rcNo);
            if (!staff) {
                // Create a temporary staff entry
                const username = staffName.toLowerCase().replace(/\s+/g, '');
                staff = { name: staffName, rcNo: rcNo, username: username };
                allStaff.push(staff);
            }
            
            // Create leave request
            const leaveRequest = {
                id: 'phone_' + Date.now(),
                type: 'leave',
                leaveType: leaveType,
                fromUsername: staff.username,
                fromName: staff.name,
                fromRcNo: rcNo,
                date: leaveDate,
                dutyTime: dutyTime,
                duration: parseFloat(duration),
                reason: reason,
                status: 'pending',
                source: 'phone',
                reportedBy: reportedBy,
                contact: contact,
                timestamp: new Date().toISOString(),
                history: [{
                    action: 'phone_reported',
                    by: reportedBy,
                    timestamp: new Date().toISOString(),
                    note: 'Reported via phone'
                }]
            };
            
            try {
                // Add to all requests
                allRequests.push(leaveRequest);
                
                // Save to Firebase
                await db.collection('requests').doc('all').set({ requests: allRequests });
                
                // Show success message
                document.getElementById('phoneFormSuccess').style.display = 'block';
                document.getElementById('phoneFormAlert').style.display = 'none';
                
                // Clear form
                clearPhoneForm();
                
                // Update displays
                updateAllDisplays();
                
                // Hide success message after 5 seconds
                setTimeout(() => {
                    document.getElementById('phoneFormSuccess').style.display = 'none';
                }, 5000);
                
                console.log('Phone-reported leave submitted:', leaveRequest);
                
            } catch (error) {
                console.error('Error saving phone leave:', error);
                document.getElementById('phoneFormAlert').textContent = 'Error saving leave request. Please try again.';
                document.getElementById('phoneFormAlert').className = 'alert alert-danger';
                document.getElementById('phoneFormAlert').style.display = 'block';
            }
        }

        // Clear phone form
        function clearPhoneForm() {
            document.getElementById('phoneLeaveForm').reset();
            document.getElementById('phoneLeaveDate').value = currentDate;
            document.getElementById('phoneFormAlert').style.display = 'block';
            document.getElementById('phoneFormAlert').textContent = 'Fill in all required fields marked with *';
            document.getElementById('phoneFormAlert').className = 'alert alert-warning';
        }

        // Update date/time display
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('currentDateTime').textContent = `${dateStr} ‚Ä¢ ${timeStr}`;
        }

        // Update last updated time
        function updateLastUpdatedTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('lastUpdatedTime').textContent = timeStr;
        }

        // Start auto-refresh
        function startAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            refreshInterval = setInterval(() => {
                loadAllData();
                console.log('Auto-refreshing data...');
            }, 60000); // Refresh every 60 seconds
        }

        // Utility functions
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'Unknown time';
            
            const now = new Date();
            const past = new Date(timestamp);
            const diffMs = now - past;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
            if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
            
            return past.toLocaleDateString();
        }

        function showErrorMessage(message) {
            const header = document.querySelector('.header');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger';
            errorDiv.textContent = message;
            errorDiv.style.marginTop = '10px';
            
            // Remove any existing error
            const existingError = header.querySelector('.alert-danger');
            if (existingError) {
                existingError.remove();
            }
            
            header.appendChild(errorDiv);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 10000);
        }

        // Manual refresh function (called by button)
        window.refreshData = function() {
            loadAllData();
        };
    </script>
</body>
</html>
