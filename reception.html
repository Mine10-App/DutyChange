<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Status Board</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="dcfire.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --danger-gradient: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            
            --sick-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            --frl-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --on-duty-gradient: linear-gradient(135deg, #96fbc4 0%, #f9f586 100%);
            --off-duty-gradient: linear-gradient(135deg, #a3bded 0%, #6991c7 100%);
            
            --surface-dark: #1a1d28;
            --surface-light: #ffffff;
            --surface-card: #ffffff;
            --surface-hover: #f8fafc;
            
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-light: #718096;
            --text-dark: #1a202c;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-50px, -50px) rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .date-time {
            font-size: 1.2rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--surface-card);
            border-radius: var(--radius-md);
            padding: 25px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: none;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.sick::before { background: var(--sick-gradient); }
        .stat-card.frl::before { background: var(--frl-gradient); }
        .stat-card.duty::before { background: var(--info-gradient); }
        .stat-card.on-duty::before { background: var(--success-gradient); }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--surface-card);
            border-radius: var(--radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            border: none;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title .icon {
            font-size: 1.8rem;
        }

        .card-count {
            background: var(--primary-gradient);
            color: white;
            padding: 6px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-md);
            margin-top: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table thead {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .data-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }

        .data-table td {
            padding: 18px 15px;
            border-bottom: 1px solid #f1f5f9;
            color: var(--text-secondary);
        }

        .data-table tr:hover td {
            background: var(--surface-hover);
        }

        /* Status Badges */
        .status-badge {
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-sick {
            background: linear-gradient(135deg, #feb692 0%, #ea5455 100%);
            color: white;
        }

        .status-sick::before {
            background: white;
        }

        .status-frl {
            background: linear-gradient(135deg, #90f7ec 0%, #32ccbc 100%);
            color: white;
        }

        .status-frl::before {
            background: white;
        }

        .status-pending {
            background: linear-gradient(135deg, #ffe985 0%, #fa742b 100%);
            color: white;
        }

        .status-pending::before {
            background: white;
        }

        .status-approved {
            background: linear-gradient(135deg, #81fbb8 0%, #28c76f 100%);
            color: white;
        }

        .status-approved::before {
            background: white;
        }

        .status-rejected {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: #721c24;
        }

        /* Duty Changes */
        .duty-changes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .duty-change-card {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            border-radius: var(--radius-md);
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: var(--transition);
        }

        .duty-change-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .duty-change-date {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-block;
        }

        .duty-change-details {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .duty-change-reason {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
        }

        /* Phone Report Form */
        .phone-form {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-top: 30px;
        }

        .form-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .form-header .icon {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-header h3 {
            font-size: 1.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-clear {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.3);
        }

        /* Alerts */
        .alert {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            border-left: 4px solid;
            font-size: 0.95rem;
        }

        .alert-info {
            background: linear-gradient(135deg, #d4f1f4 0%, #b3d9ff 100%);
            border-color: #189ab4;
            color: #05445e;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
            color: #155724;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #ffc107;
            color: #856404;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
            border-color: #dc3545;
            color: #721c24;
        }

        /* Recent Activity */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .activity-item {
            position: relative;
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .activity-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: -35px;
            top: 24px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px;
        }

        .activity-item.sick::before {
            background: #fda085;
            box-shadow: 0 0 0 3px #fda085;
        }

        .activity-item.frl::before {
            background: #90f7ec;
            box-shadow: 0 0 0 3px #90f7ec;
        }

        .activity-item.duty-change::before {
            background: #667eea;
            box-shadow: 0 0 0 3px #667eea;
        }

        .activity-content {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .activity-staff {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .activity-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .activity-type.sick {
            background: linear-gradient(135deg, #feb692 0%, #ea5455 100%);
            color: white;
        }

        .activity-type.frl {
            background: linear-gradient(135deg, #90f7ec 0%, #32ccbc 100%);
            color: white;
        }

        .activity-type.duty-change {
            background: linear-gradient(135deg, #a3bffa 0%, #667eea 100%);
            color: white;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Loading States */
        .loading-state {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-light);
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .update-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .update-info .pulse {
            width: 8px;
            height: 8px;
            background: #28c76f;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Utility Classes */
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mb-5 { margin-bottom: 2rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-5 { margin-top: 2rem; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üìã Duty Status Board</h1>
            <div class="header-content">
                <div class="date-time" id="currentDateTime">Loading...</div>
                <button class="refresh-btn" onclick="loadAllData()">
                    <span>‚Üª</span>
                    Refresh Dashboard
                </button>
            </div>
        </header>

        <!-- Stats Overview -->
        <div class="stats-grid" id="overviewStats">
            <div class="stat-card sick">
                <div class="stat-icon">ü§í</div>
                <div class="stat-value" id="sickCount">0</div>
                <div class="stat-label">Sick Leave Today</div>
            </div>
            
            <div class="stat-card frl">
                <div class="stat-icon">üèùÔ∏è</div>
                <div class="stat-value" id="frlCount">0</div>
                <div class="stat-label">FRL Today</div>
            </div>
            
            <div class="stat-card duty">
                <div class="stat-icon">üîÑ</div>
                <div class="stat-value" id="dutyChangeCount">0</div>
                <div class="stat-label">Duty Changes</div>
            </div>
            
            <div class="stat-card on-duty">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="onDutyCount">0</div>
                <div class="stat-label">Staff on Duty</div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Left Column -->
            <div>
                <!-- Today's Sick Leave -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">ü§í</span>
                            Today's Sick Leave
                        </h2>
                    </div>
                    <div id="todaySickLeave">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Loading sick leave data...</p>
                        </div>
                    </div>
                </div>

                <!-- Today's FRL -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">üèùÔ∏è</span>
                            Today's FRL
                        </h2>
                    </div>
                    <div id="todayFRL">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Loading FRL data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Approved Duty Changes -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">üîÑ</span>
                            Approved Duty Changes
                        </h2>
                        <div class="filters">
                            <button class="filter-btn active" onclick="filterDutyChanges('all')">All</button>
                            <button class="filter-btn" onclick="filterDutyChanges('today')">Today</button>
                            <button class="filter-btn" onclick="filterDutyChanges('tomorrow')">Tomorrow</button>
                        </div>
                    </div>
                    <div id="approvedDutyChanges">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Loading duty changes...</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">üïí</span>
                            Recent Activity
                        </h2>
                    </div>
                    <div class="activity-timeline" id="recentActivity">
                        <div class="loading-state">
                            <div class="spinner"></div>
                            <p>Loading recent activity...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phone-Reported Leave Form -->
        <div class="phone-form">
            <div class="form-header">
                <div class="icon">üìû</div>
                <h3>Phone-Reported Leave Entry</h3>
            </div>
            
            <div class="alert alert-info">
                Use this form to record leaves reported by phone. A pending leave request will be created for supervisor approval.
            </div>
            
            <form id="phoneLeaveForm" onsubmit="submitPhoneLeave(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="phoneStaffName">Staff Name *</label>
                        <input type="text" id="phoneStaffName" class="form-control" 
                               placeholder="Enter staff name" required>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Start typing to see suggestions</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneStaffRC">RC Number *</label>
                        <input type="text" id="phoneStaffRC" class="form-control" 
                               placeholder="Enter RC number" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneLeaveType">Leave Type *</label>
                        <select id="phoneLeaveType" class="form-control" required>
                            <option value="">Select leave type</option>
                            <option value="Sick Leave">Sick Leave</option>
                            <option value="FRL">FRL</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneLeaveDate">Leave Date *</label>
                        <input type="date" id="phoneLeaveDate" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneDutyTime">Duty Time *</label>
                        <input type="text" id="phoneDutyTime" class="form-control" 
                               placeholder="e.g., 08:00-16:00" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneDuration">Duration *</label>
                        <select id="phoneDuration" class="form-control" required>
                            <option value="1">1 Day</option>
                            <option value="0.5">Half Day</option>
                            <option value="2">2 Days</option>
                            <option value="3">3 Days</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phoneReason">Reason for Leave *</label>
                    <textarea id="phoneReason" class="form-control" rows="3" 
                              placeholder="Enter reason for leave (e.g., fever, personal work, etc.)" 
                              required></textarea>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="phoneReportedBy">Reported By *</label>
                        <input type="text" id="phoneReportedBy" class="form-control" 
                               placeholder="Your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phoneContact">Contact Number</label>
                        <input type="text" id="phoneContact" class="form-control" 
                               placeholder="Contact number (optional)">
                    </div>
                </div>
                
                <div class="alert alert-warning" id="phoneFormAlert" style="display: none;">
                    Please fill all required fields marked with *
                </div>
                
                <div class="alert alert-success" id="phoneFormSuccess" style="display: none;">
                    ‚úì Leave successfully recorded! A pending request has been created for supervisor approval.
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-submit">
                        <span>üìû</span>
                        Submit Phone-Reported Leave
                    </button>
                    <button type="button" class="btn btn-clear" onclick="clearPhoneForm()">
                        Clear Form
                    </button>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Duty Status Board ‚Ä¢ Auto-refreshes every 60 seconds</p>
            <div class="update-info">
                <span class="pulse"></span>
                <span>Last updated: <strong id="lastUpdatedTime">--:--:--</strong></span>
            </div>
        </footer>
    </div>

   <script>
    // Global variables
    let allStaff = [];
    let dutyRoster = {};
    let leaveRequests = [];
    let allRequests = [];
    let refreshInterval;
    let currentDate = new Date().toISOString().split('T')[0];
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Duty Status Board loading...');
        
        // Set default date for forms
        document.getElementById('phoneLeaveDate').value = currentDate;
        
        // Initialize Firebase and load data
        initializeApp();
        
        // Update current date/time display
        updateDateTime();
        setInterval(updateDateTime, 1000);
        
        // Setup staff name suggestions
        setupStaffSuggestions();
        
        // Start auto-refresh
        startAutoRefresh();
    });

    // Initialize Firebase app
    async function initializeApp() {
        try {
            // Load all data
            await loadAllData();
            console.log('App initialized successfully');
        } catch (error) {
            console.error('Error initializing app:', error);
            showErrorMessage('Failed to initialize. Please refresh the page.');
        }
    }

    // Load all data from Firebase
    async function loadAllData() {
        try {
            console.log('Loading data from Firebase...');
            
            // Update last updated time
            updateLastUpdatedTime();
            
            // Load staff data
            await loadStaffData();
            
            // Load duty roster
            await loadDutyRoster();
            
            // Load all requests (including leave requests)
            await loadAllRequests();
            
            // Update all displays
            updateAllDisplays();
            
            console.log('Data loaded successfully');
        } catch (error) {
            console.error('Error loading data:', error);
            showErrorMessage('Failed to load data. Please refresh the page.');
        }
    }

    // Load staff data
    async function loadStaffData() {
        try {
            // Load from Firebase collection 'staff'
            const staffSnapshot = await db.collection('staff').get();
            
            if (!staffSnapshot.empty) {
                allStaff = [];
                staffSnapshot.forEach(doc => {
                    const staffData = doc.data();
                    allStaff.push({
                        id: doc.id,
                        name: staffData.name || staffData.displayName || 'Unknown',
                        rcNo: staffData.rcNo || staffData.employeeId || '',
                        username: staffData.username || staffData.email || '',
                        email: staffData.email || '',
                        department: staffData.department || '',
                        position: staffData.position || ''
                    });
                });
                console.log('Staff data loaded:', allStaff.length, 'staff members');
            } else {
                // Default staff list if Firebase collection is empty
                allStaff = [
                    { id: '1', name: "Irufan1", rcNo: "001", username: "irufan1", email: "irufan1@example.com" },
                    { id: '2', name: "Irufan2", rcNo: "002", username: "irufan2", email: "irufan2@example.com" },
                    { id: '3', name: "Hussain", rcNo: "003", username: "hussain", email: "hussain@example.com" },
                    { id: '4', name: "Mohamed", rcNo: "004", username: "mohamed", email: "mohamed@example.com" }
                ];
                console.log('Using default staff data');
            }
        } catch (error) {
            console.error('Error loading staff data:', error);
            allStaff = [];
        }
    }

    // Load duty roster
    async function loadDutyRoster() {
        try {
            // Load from Firebase collection 'dutyRoster' or 'dutySchedule'
            const today = currentDate;
            const rosterDoc = await db.collection('dutyRoster').doc(today).get();
            
            if (rosterDoc.exists) {
                dutyRoster = rosterDoc.data() || {};
                console.log('Duty roster loaded for:', today);
            } else {
                // Try alternative collection name
                const scheduleDoc = await db.collection('dutySchedule').doc(today).get();
                if (scheduleDoc.exists) {
                    dutyRoster = scheduleDoc.data() || {};
                } else {
                    dutyRoster = {};
                    
                    // Create a sample roster for demo
                    allStaff.forEach(staff => {
                        const hours = ['08:00-16:00', '09:00-17:00', '10:00-18:00'];
                        const randomHour = hours[Math.floor(Math.random() * hours.length)];
                        dutyRoster[staff.username] = Math.random() > 0.3 ? randomHour : 'Off';
                    });
                    
                    console.log('Created sample duty roster');
                }
            }
        } catch (error) {
            console.error('Error loading duty roster:', error);
            dutyRoster = {};
        }
    }

    // Load all requests
    async function loadAllRequests() {
        try {
            // Load from Firebase collection 'requests'
            const requestsSnapshot = await db.collection('requests')
                .where('status', '==', 'approved')
                .orderBy('timestamp', 'desc')
                .limit(100)
                .get();
            
            allRequests = [];
            leaveRequests = [];
            
            if (!requestsSnapshot.empty) {
                requestsSnapshot.forEach(doc => {
                    const requestData = doc.data();
                    requestData.id = doc.id;
                    allRequests.push(requestData);
                    
                    // Filter leave requests
                    if (requestData.type === 'leave') {
                        leaveRequests.push(requestData);
                    }
                });
                
                console.log('Requests loaded:', allRequests.length, 'total,', leaveRequests.length, 'leave requests');
            } else {
                console.log('No requests found in database');
                allRequests = [];
                leaveRequests = [];
            }
        } catch (error) {
            console.error('Error loading requests:', error);
            allRequests = [];
            leaveRequests = [];
        }
    }

    // Update all displays
    function updateAllDisplays() {
        updateOverviewStats();
        updateTodaySickLeave();
        updateTodayFRL();
        updateApprovedDutyChanges();
        updateRecentActivity();
    }

    // Update overview statistics
    function updateOverviewStats() {
        const today = currentDate;
        
        // Get today's sick leave
        const todaySickLeave = leaveRequests.filter(req => 
            req.status === 'approved' && 
            req.leaveType === 'Sick Leave' &&
            isSameDay(req.date, today)
        ).length;
        
        // Get today's FRL
        const todayFRL = leaveRequests.filter(req => 
            req.status === 'approved' && 
            req.leaveType === 'FRL' &&
            isSameDay(req.date, today)
        ).length;
        
        // Get duty changes for today
        const todayDutyChanges = allRequests.filter(req => 
            req.type === 'dutyChange' && 
            req.status === 'approved' &&
            isSameDay(req.date, today)
        ).length;
        
        // Count staff on duty today
        let onDutyCount = 0;
        if (dutyRoster) {
            Object.values(dutyRoster).forEach(duty => {
                if (duty && duty !== 'Off' && duty !== 'Not Scheduled' && duty !== 'OFF') {
                    onDutyCount++;
                }
            });
        }
        
        // Update stat cards
        document.getElementById('sickCount').textContent = todaySickLeave;
        document.getElementById('frlCount').textContent = todayFRL;
        document.getElementById('dutyChangeCount').textContent = todayDutyChanges;
        document.getElementById('onDutyCount').textContent = onDutyCount;
    }

    // Update today's sick leave display
    function updateTodaySickLeave() {
        const container = document.getElementById('todaySickLeave');
        const today = currentDate;
        
        const todaySickRequests = leaveRequests.filter(req => 
            req.status === 'approved' && 
            req.leaveType === 'Sick Leave' &&
            isSameDay(req.date, today)
        );
        
        if (todaySickRequests.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üòä</div>
                    <p>No sick leave today</p>
                    <p style="font-size: 0.9rem;">All staff are healthy!</p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Name</th>
                            <th>RC No</th>
                            <th>Duration</th>
                            <th>Reason</th>
                            <th>Reported At</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        todaySickRequests.forEach(req => {
            const staff = allStaff.find(s => s.username === req.fromUsername || s.rcNo === req.fromRcNo) || { 
                name: req.fromName || 'Unknown', 
                rcNo: req.fromRcNo || 'N/A' 
            };
            
            const reportedTime = req.timestamp ? formatDateTime(new Date(req.timestamp)) : 'N/A';
            const duration = req.duration ? `${req.duration} day${req.duration > 1 ? 's' : ''}` : 'N/A';
            
            html += `
                <tr>
                    <td><strong>${staff.name}</strong></td>
                    <td>${staff.rcNo}</td>
                    <td><span class="status-badge status-sick">${duration}</span></td>
                    <td>${req.reason || 'Not specified'}</td>
                    <td>${reportedTime}</td>
                </tr>
            `;
        });
        
        html += `
                    </tbody>
                </table>
            </div>
        `;
        
        container.innerHTML = html;
    }

    // Update today's FRL display
    function updateTodayFRL() {
        const container = document.getElementById('todayFRL');
        const today = currentDate;
        
        const todayFRLRequests = leaveRequests.filter(req => 
            req.status === 'approved' && 
            req.leaveType === 'FRL' &&
            isSameDay(req.date, today)
        );
        
        if (todayFRLRequests.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üòä</div>
                    <p>No FRL today</p>
                    <p style="font-size: 0.9rem;">All staff are available!</p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Staff Name</th>
                            <th>RC No</th>
                            <th>Duration</th>
                            <th>Reason</th>
                            <th>Reported At</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        todayFRLRequests.forEach(req => {
            const staff = allStaff.find(s => s.username === req.fromUsername || s.rcNo === req.fromRcNo) || { 
                name: req.fromName || 'Unknown', 
                rcNo: req.fromRcNo || 'N/A' 
            };
            
            const reportedTime = req.timestamp ? formatDateTime(new Date(req.timestamp)) : 'N/A';
            const duration = req.duration ? `${req.duration} day${req.duration > 1 ? 's' : ''}` : 'N/A';
            
            html += `
                <tr>
                    <td><strong>${staff.name}</strong></td>
                    <td>${staff.rcNo}</td>
                    <td><span class="status-badge status-frl">${duration}</span></td>
                    <td>${req.reason || 'Not specified'}</td>
                    <td>${reportedTime}</td>
                </tr>
            `;
        });
        
        html += `
                    </tbody>
                </table>
            </div>
        `;
        
        container.innerHTML = html;
    }

    // Update approved duty changes
    function updateApprovedDutyChanges() {
        const container = document.getElementById('approvedDutyChanges');
        const today = new Date(currentDate);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const todayStr = today.toISOString().split('T')[0];
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        
        // Get approved duty changes for today and tomorrow
        const approvedChanges = allRequests.filter(req => 
            req.type === 'dutyChange' && 
            req.status === 'approved' && 
            (isSameDay(req.date, todayStr) || isSameDay(req.date, tomorrowStr))
        );
        
        if (approvedChanges.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üîÑ</div>
                    <p>No approved duty changes</p>
                    <p style="font-size: 0.9rem;">All duties are as scheduled</p>
                </div>
            `;
            return;
        }
        
        // Group by date
        const changesByDate = {};
        approvedChanges.forEach(req => {
            const date = req.date;
            if (!changesByDate[date]) {
                changesByDate[date] = [];
            }
            changesByDate[date].push(req);
        });
        
        let html = '<div class="duty-changes-grid">';
        
        // Show today's changes first, then tomorrow's
        [todayStr, tomorrowStr].forEach(date => {
            if (changesByDate[date]) {
                const isToday = date === todayStr;
                const dateLabel = isToday ? 'Today' : 'Tomorrow';
                const dateDisplay = formatDateDisplay(date);
                
                changesByDate[date].forEach(req => {
                    const fromStaff = allStaff.find(s => s.username === req.fromUsername) || { name: req.fromName || 'Unknown' };
                    const toStaff = allStaff.find(s => s.username === req.toUsername) || { name: req.toName || 'Unknown' };
                    
                    html += `
                        <div class="duty-change-card">
                            <div class="duty-change-date">${dateLabel} ‚Ä¢ ${dateDisplay}</div>
                            <div class="duty-change-details">
                                ${fromStaff.name} (${req.dutyTime || 'N/A'}) 
                                ‚Üî 
                                ${toStaff.name} (${req.toDutyTime || 'N/A'})
                            </div>
                            ${req.reason ? `<div class="duty-change-reason">Reason: ${req.reason}</div>` : ''}
                            <div style="margin-top: 10px; font-size: 0.85rem; color: #666;">
                                Approved ${formatTimeAgo(req.approvedAt || req.timestamp)}
                            </div>
                        </div>
                    `;
                });
            }
        });
        
        html += '</div>';
        container.innerHTML = html;
    }

    // Filter duty changes
    function filterDutyChanges(filter) {
        // Update filter buttons
        document.querySelectorAll('#dutyChangeFilters .filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        const container = document.getElementById('approvedDutyChanges');
        const today = new Date(currentDate);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const todayStr = today.toISOString().split('T')[0];
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        
        // Get approved duty changes
        let filteredChanges = allRequests.filter(req => 
            req.type === 'dutyChange' && 
            req.status === 'approved'
        );
        
        // Apply filter
        if (filter === 'today') {
            filteredChanges = filteredChanges.filter(req => isSameDay(req.date, todayStr));
        } else if (filter === 'tomorrow') {
            filteredChanges = filteredChanges.filter(req => isSameDay(req.date, tomorrowStr));
        }
        
        if (filteredChanges.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üîÑ</div>
                    <p>No approved duty changes ${filter !== 'all' ? 'for ' + filter : ''}</p>
                    <p style="font-size: 0.9rem;">All duties are as scheduled</p>
                </div>
            `;
            return;
        }
        
        let html = '<div class="duty-changes-grid">';
        
        filteredChanges.forEach(req => {
            const isToday = isSameDay(req.date, todayStr);
            const dateLabel = isToday ? 'Today' : isSameDay(req.date, tomorrowStr) ? 'Tomorrow' : formatDateDisplay(req.date);
            
            const fromStaff = allStaff.find(s => s.username === req.fromUsername) || { name: req.fromName || 'Unknown' };
            const toStaff = allStaff.find(s => s.username === req.toUsername) || { name: req.toName || 'Unknown' };
            
            html += `
                <div class="duty-change-card">
                    <div class="duty-change-date">${dateLabel} ‚Ä¢ ${formatDateDisplay(req.date)}</div>
                    <div class="duty-change-details">
                        ${fromStaff.name} (${req.dutyTime || 'N/A'}) 
                        ‚Üî 
                        ${toStaff.name} (${req.toDutyTime || 'N/A'})
                    </div>
                    ${req.reason ? `<div class="duty-change-reason">Reason: ${req.reason}</div>` : ''}
                    <div style="margin-top: 10px; font-size: 0.85rem; color: #666;">
                        Approved ${formatTimeAgo(req.approvedAt || req.timestamp)}
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }

    // Update recent activity (only today's)
    function updateRecentActivity() {
        const container = document.getElementById('recentActivity');
        const today = currentDate;
        
        // Get today's activity (all types)
        const todayActivity = allRequests.filter(req => {
            const requestDate = new Date(req.timestamp || req.approvedAt || req.createdAt);
            const requestDateStr = requestDate.toISOString().split('T')[0];
            return requestDateStr === today;
        }).sort((a, b) => {
            const timeA = new Date(a.timestamp || a.approvedAt || a.createdAt);
            const timeB = new Date(b.timestamp || b.approvedAt || b.createdAt);
            return timeB - timeA; // Newest first
        }).slice(0, 10); // Limit to 10 items
        
        if (todayActivity.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üìù</div>
                    <p>No activity today</p>
                    <p style="font-size: 0.9rem;">All updates will appear here</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        todayActivity.forEach(req => {
            let activityType = '';
            let activityClass = '';
            let icon = 'üìù';
            
            if (req.type === 'leave') {
                activityType = req.leaveType === 'Sick Leave' ? 'Sick Leave' : 'FRL';
                activityClass = req.leaveType === 'Sick Leave' ? 'sick' : 'frl';
                icon = req.leaveType === 'Sick Leave' ? 'ü§í' : 'üèùÔ∏è';
            } else if (req.type === 'dutyChange') {
                activityType = 'Duty Change';
                activityClass = 'duty-change';
                icon = 'üîÑ';
            } else {
                activityType = req.type || 'Activity';
                activityClass = 'other';
            }
            
            const time = req.timestamp ? formatTime(new Date(req.timestamp)) : 'Just now';
            const staffName = req.fromName || allStaff.find(s => s.username === req.fromUsername)?.name || 'Staff Member';
            
            html += `
                <div class="activity-item ${activityClass}">
                    <div class="activity-content">
                        <div class="activity-staff">${staffName}</div>
                        <span class="activity-type ${activityClass}">${activityType}</span>
                        <div>${req.reason || 'No reason provided'}</div>
                        <div class="activity-time">
                            <span>üïí</span>
                            ${time}
                        </div>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }

    // Setup staff name suggestions
    function setupStaffSuggestions() {
        const nameInput = document.getElementById('phoneStaffName');
        const rcInput = document.getElementById('phoneStaffRC');
        
        if (!nameInput) return;
        
        let suggestionsDiv = document.createElement('div');
        suggestionsDiv.className = 'suggestions-dropdown';
        suggestionsDiv.style.cssText = `
            position: absolute;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        `;
        
        nameInput.parentNode.style.position = 'relative';
        nameInput.parentNode.appendChild(suggestionsDiv);
        
        nameInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            if (query.length < 1) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            const matches = allStaff.filter(staff => 
                staff.name.toLowerCase().includes(query) || 
                (staff.rcNo && staff.rcNo.toLowerCase().includes(query))
            ).slice(0, 5);
            
            if (matches.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            suggestionsDiv.innerHTML = '';
            matches.forEach(staff => {
                const div = document.createElement('div');
                div.style.cssText = `
                    padding: 10px 15px;
                    cursor: pointer;
                    border-bottom: 1px solid #f1f5f9;
                    transition: background-color 0.2s;
                `;
                div.innerHTML = `
                    <div style="font-weight: 600; color: #2d3748;">${staff.name}</div>
                    <div style="font-size: 0.85rem; color: #718096;">RC: ${staff.rcNo || 'N/A'}</div>
                `;
                div.onmouseover = () => div.style.backgroundColor = '#f7fafc';
                div.onmouseout = () => div.style.backgroundColor = 'white';
                div.onclick = function() {
                    nameInput.value = staff.name;
                    rcInput.value = staff.rcNo || '';
                    suggestionsDiv.style.display = 'none';
                };
                suggestionsDiv.appendChild(div);
            });
            
            suggestionsDiv.style.display = 'block';
            suggestionsDiv.style.width = nameInput.offsetWidth + 'px';
            suggestionsDiv.style.top = (nameInput.offsetHeight + 5) + 'px';
        });
        
        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!nameInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });
    }

    // Submit phone-reported leave
    async function submitPhoneLeave(event) {
        event.preventDefault();
        
        const staffName = document.getElementById('phoneStaffName').value.trim();
        const rcNo = document.getElementById('phoneStaffRC').value.trim();
        const leaveType = document.getElementById('phoneLeaveType').value;
        const leaveDate = document.getElementById('phoneLeaveDate').value;
        const dutyTime = document.getElementById('phoneDutyTime').value.trim();
        const duration = document.getElementById('phoneDuration').value;
        const reason = document.getElementById('phoneReason').value.trim();
        const reportedBy = document.getElementById('phoneReportedBy').value.trim();
        const contact = document.getElementById('phoneContact').value.trim();
        
        // Validation
        if (!staffName || !rcNo || !leaveType || !leaveDate || !dutyTime || !reason || !reportedBy) {
            document.getElementById('phoneFormAlert').style.display = 'block';
            document.getElementById('phoneFormAlert').textContent = 'Please fill all required fields marked with *';
            document.getElementById('phoneFormAlert').className = 'alert alert-danger';
            return;
        }
        
        // Validate duty time format
        const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]-([01]?[0-9]|2[0-3]):[0-5][0-9]$/;
        if (!timeRegex.test(dutyTime)) {
            document.getElementById('phoneFormAlert').style.display = 'block';
            document.getElementById('phoneFormAlert').textContent = 'Please enter duty time in format HH:MM-HH:MM (e.g., 08:00-16:00)';
            document.getElementById('phoneFormAlert').className = 'alert alert-danger';
            return;
        }
        
        // Find or create staff
        let staff = allStaff.find(s => s.rcNo === rcNo);
        if (!staff) {
            // Create a temporary staff entry
            const username = staffName.toLowerCase().replace(/\s+/g, '_');
            staff = { 
                name: staffName, 
                rcNo: rcNo, 
                username: username,
                id: 'temp_' + Date.now()
            };
            allStaff.push(staff);
        }
        
        // Create leave request object
        const leaveRequest = {
            type: 'leave',
            leaveType: leaveType,
            fromUsername: staff.username,
            fromName: staff.name,
            fromRcNo: rcNo,
            date: leaveDate,
            dutyTime: dutyTime,
            duration: parseFloat(duration),
            reason: reason,
            status: 'pending',
            source: 'phone_report',
            reportedBy: reportedBy,
            contact: contact,
            timestamp: new Date().toISOString(),
            createdAt: new Date().toISOString(),
            history: [{
                action: 'phone_reported',
                by: reportedBy,
                timestamp: new Date().toISOString(),
                note: 'Reported via phone'
            }]
        };
        
        try {
            // Save to Firebase
            const docRef = await db.collection('requests').add(leaveRequest);
            console.log('Phone-reported leave saved with ID:', docRef.id);
            
            // Add to local arrays for immediate display
            leaveRequest.id = docRef.id;
            allRequests.unshift(leaveRequest); // Add at beginning
            leaveRequests.unshift(leaveRequest);
            
            // Show success message
            const successAlert = document.getElementById('phoneFormSuccess');
            successAlert.style.display = 'block';
            successAlert.textContent = '‚úì Leave successfully recorded! A pending request has been created for supervisor approval.';
            
            // Hide warning alert
            document.getElementById('phoneFormAlert').style.display = 'none';
            
            // Clear form
            clearPhoneForm();
            
            // Update displays
            updateAllDisplays();
            
            // Hide success message after 5 seconds
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 5000);
            
        } catch (error) {
            console.error('Error saving phone leave:', error);
            document.getElementById('phoneFormAlert').style.display = 'block';
            document.getElementById('phoneFormAlert').textContent = 'Error saving leave request. Please try again.';
            document.getElementById('phoneFormAlert').className = 'alert alert-danger';
        }
    }

    // Clear phone form
    function clearPhoneForm() {
        document.getElementById('phoneLeaveForm').reset();
        document.getElementById('phoneLeaveDate').value = currentDate;
        document.getElementById('phoneFormAlert').style.display = 'none';
        document.getElementById('phoneFormSuccess').style.display = 'none';
    }

    // Update date/time display
    function updateDateTime() {
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        const timeStr = now.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit',
            hour12: true 
        });
        document.getElementById('currentDateTime').textContent = `${dateStr} ‚Ä¢ ${timeStr}`;
    }

    // Update last updated time
    function updateLastUpdatedTime() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit',
            hour12: true 
        });
        document.getElementById('lastUpdatedTime').textContent = timeStr;
    }

    // Start auto-refresh
    function startAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
        }
        
        refreshInterval = setInterval(() => {
            loadAllData();
            console.log('Auto-refreshing data...');
        }, 60000); // Refresh every 60 seconds
    }

    // Utility functions
    function formatTime(date) {
        return date.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true 
        });
    }

    function formatDateTime(date) {
        return date.toLocaleString('en-US', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: true,
            month: 'short',
            day: 'numeric'
        });
    }

    function formatDateDisplay(dateStr) {
        const date = new Date(dateStr);
        const today = new Date(currentDate);
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        if (date.toDateString() === today.toDateString()) {
            return 'Today';
        } else if (date.toDateString() === tomorrow.toDateString()) {
            return 'Tomorrow';
        } else {
            return date.toLocaleDateString('en-US', { 
                weekday: 'short',
                month: 'short', 
                day: 'numeric' 
            });
        }
    }

    function formatTimeAgo(timestamp) {
        if (!timestamp) return 'recently';
        
        const now = new Date();
        const past = new Date(timestamp);
        const diffMs = now - past;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);
        
        if (diffMins < 1) return 'just now';
        if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
        if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
        if (diffDays < 7) return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
        
        return past.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric',
            year: 'numeric'
        });
    }

    function isSameDay(dateStr1, dateStr2) {
        const date1 = new Date(dateStr1);
        const date2 = new Date(dateStr2);
        return date1.toDateString() === date2.toDateString();
    }

    function showErrorMessage(message) {
        const header = document.querySelector('.header');
        const errorDiv = document.createElement('div');
        errorDiv.className = 'alert alert-danger';
        errorDiv.textContent = message;
        errorDiv.style.marginTop = '10px';
        errorDiv.style.marginBottom = '0';
        
        // Remove any existing error
        const existingError = header.querySelector('.alert-danger');
        if (existingError) {
            existingError.remove();
        }
        
        header.appendChild(errorDiv);
        
        // Auto-remove after 10 seconds
        setTimeout(() => {
            errorDiv.remove();
        }, 10000);
    }

    // Manual refresh function (called by button)
    window.loadAllData = function() {
        loadAllData();
    };
</script>
    
</body>
</html>
